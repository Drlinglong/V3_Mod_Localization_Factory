#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æµ‹è¯•åå¤„ç†éªŒè¯å™¨çš„é—®é¢˜æ£€æµ‹åŠŸèƒ½
åˆ›å»ºåŒ…å«å„ç§æ ¼å¼é—®é¢˜çš„ç¿»è¯‘æ–‡ä»¶ï¼Œä»¥ä¾¿æµ‹è¯•éªŒè¯å™¨çš„é”™è¯¯ã€è­¦å‘Šå’Œä¿¡æ¯æ£€æµ‹
"""

import os
import sys

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

# è®¾ç½®ç¯å¢ƒå˜é‡è·³è¿‡è¯­è¨€é€‰æ‹©
os.environ['SKIP_LANGUAGE_SELECTION'] = '1'

def create_test_files_with_issues():
    """åˆ›å»ºåŒ…å«æ ¼å¼é—®é¢˜çš„æµ‹è¯•æ–‡ä»¶"""
    
    # åˆ›å»ºæµ‹è¯•ç›®å½•
    test_dir = "test_validation_issues"
    os.makedirs(test_dir, exist_ok=True)
    
    # åˆ›å»ºåŒ…å«å„ç§é—®é¢˜çš„Victoria 3ç¿»è¯‘æ–‡ä»¶
    vic3_content = """l_simp_chinese:
# æ­£å¸¸æ–‡æœ¬
test_normal: "è¿™æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç¿»è¯‘æ–‡æœ¬"
test_concept: "è¿™æ˜¯ä¸€ä¸ªæ¦‚å¿µé“¾æ¥ [concept_legitimacy] çš„æ–‡æœ¬"

# é”™è¯¯çº§åˆ«é—®é¢˜ (ERROR) - ä¼šå¯¼è‡´æ¸¸æˆå´©æºƒæˆ–æ— æ³•è¯†åˆ«
test_chinese_in_brackets: "æ–¹æ‹¬å·å†…åŒ…å«ä¸­æ–‡ [ä¸­æ–‡å‡½æ•°] è¿™æ˜¯é”™è¯¯çš„"
test_chinese_in_concept: "[Concept('ä¸­æ–‡key', 'æ˜¾ç¤ºæ–‡æœ¬')] æ¦‚å¿µé”®åŒ…å«ä¸­æ–‡"
test_chinese_in_scope: "[SCOPE.sCountry('ä¸­æ–‡scope')] ä½œç”¨åŸŸé”®åŒ…å«ä¸­æ–‡"
test_chinese_in_icon: "å›¾æ ‡æ ‡ç­¾åŒ…å«ä¸­æ–‡ @ä¸­æ–‡å›¾æ ‡!"

# è­¦å‘Šçº§åˆ«é—®é¢˜ (WARNING) - å¯èƒ½å¯¼è‡´æ˜¾ç¤ºå¼‚å¸¸ä½†ä¸ä¼šå´©æºƒ
test_missing_space: "æ ¼å¼åŒ–å‘½ä»¤ç¼ºå°‘ç©ºæ ¼ #bç²—ä½“æ–‡æœ¬#! åº”è¯¥ #b ç²—ä½“æ–‡æœ¬#!"
test_unknown_formatting: "ä½¿ç”¨æœªçŸ¥çš„æ ¼å¼åŒ–å‘½ä»¤ #bold ç²—ä½“æ–‡æœ¬#! åº”è¯¥æ˜¯ #b"
test_unpaired_tags: "é¢œè‰²æ ‡ç­¾ä¸æˆå¯¹ #R çº¢è‰²æ–‡æœ¬ æ²¡æœ‰ç»“æŸç¬¦"

# ä¿¡æ¯çº§åˆ«é—®é¢˜ (INFO) - å»ºè®®æ£€æŸ¥ä½†å½±å“è¾ƒå°
test_tooltip_complex: "å¤æ‚çš„æç¤ºæ¡† #tooltippable;tooltip:<ä¸­æ–‡tooltip_key> æ–‡æœ¬"
test_scope_complex: "å¤æ‚çš„ä½œç”¨åŸŸ [This.GetName|ä¸­æ–‡æ ¼å¼åŒ–] åŒ…å«ä¸­æ–‡"
"""

    # åˆ›å»ºåŒ…å«å„ç§é—®é¢˜çš„Stellarisç¿»è¯‘æ–‡ä»¶
    stellaris_content = """l_simp_chinese:
# æ­£å¸¸æ–‡æœ¬
test_normal: "è¿™æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç¾¤æ˜Ÿç¿»è¯‘æ–‡æœ¬"
test_scope: "ä½œç”¨åŸŸå‘½ä»¤ [Root.GetName] æ­£å¸¸"

# é”™è¯¯çº§åˆ«é—®é¢˜
test_chinese_in_brackets: "æ–¹æ‹¬å·å†…åŒ…å«ä¸­æ–‡ [Root.ä¸­æ–‡å‡½æ•°] é”™è¯¯"
test_chinese_in_vars: "å˜é‡åŒ…å«ä¸­æ–‡ $ä¸­æ–‡å˜é‡$ é”™è¯¯"
test_chinese_in_icons: "å›¾æ ‡åŒ…å«ä¸­æ–‡ Â£ä¸­æ–‡å›¾æ ‡Â£ é”™è¯¯"

# è­¦å‘Šçº§åˆ«é—®é¢˜
test_color_tags_mismatch: "é¢œè‰²æ ‡ç­¾ä¸åŒ¹é… Â§R çº¢è‰²æ–‡æœ¬ Â§Y é»„è‰²æ–‡æœ¬ æ²¡æœ‰ç»“æŸç¬¦"
test_escaped_brackets: "è½¬ä¹‰æ‹¬å·é”™è¯¯ [[ åº”è¯¥æ˜¯å•ä¸ª ["
"""

    # å†™å…¥æµ‹è¯•æ–‡ä»¶
    with open(os.path.join(test_dir, "vic3_test.yml"), "w", encoding="utf-8-sig") as f:
        f.write(vic3_content)
    
    with open(os.path.join(test_dir, "stellaris_test.yml"), "w", encoding="utf-8-sig") as f:
        f.write(stellaris_content)
    
    print(f"âœ… æµ‹è¯•æ–‡ä»¶å·²åˆ›å»ºåœ¨ {test_dir} ç›®å½•ä¸­")
    print("è¿™äº›æ–‡ä»¶åŒ…å«å„ç§æ ¼å¼é—®é¢˜ï¼Œå¯ä»¥ç”¨æ¥æµ‹è¯•åå¤„ç†éªŒè¯å™¨")
    
    return test_dir

def explain_validation_levels():
    """è§£é‡ŠéªŒè¯çº§åˆ«çš„åŒºåˆ«"""
    print("\n" + "="*60)
    print("åå¤„ç†éªŒè¯çº§åˆ«è¯´æ˜")
    print("="*60)
    
    print("\nğŸ”´ ERROR (é”™è¯¯) - æœ€é«˜çº§åˆ«ï¼Œå¿…é¡»ä¿®å¤ï¼š")
    print("   â€¢ æ–¹æ‹¬å·å†…åŒ…å«ä¸­æ–‡å­—ç¬¦: [ä¸­æ–‡å‡½æ•°]")
    print("   â€¢ æ¦‚å¿µé”®åŒ…å«ä¸­æ–‡: [Concept('ä¸­æ–‡key', ...)]")
    print("   â€¢ å˜é‡ååŒ…å«ä¸­æ–‡: $ä¸­æ–‡å˜é‡$")
    print("   â€¢ å›¾æ ‡æ ‡ç­¾åŒ…å«ä¸­æ–‡: @ä¸­æ–‡å›¾æ ‡!")
    print("   â†’ è¿™äº›ä¼šå¯¼è‡´æ¸¸æˆå´©æºƒã€æ— æ³•è¯†åˆ«æŒ‡ä»¤æˆ–æ˜¾ç¤ºå¼‚å¸¸")
    
    print("\nğŸŸ¡ WARNING (è­¦å‘Š) - ä¸­ç­‰çº§åˆ«ï¼Œå»ºè®®ä¿®å¤ï¼š")
    print("   â€¢ æ ¼å¼åŒ–å‘½ä»¤ç¼ºå°‘ç©ºæ ¼: #bç²—ä½“æ–‡æœ¬#! (åº”è¯¥æ˜¯ #b ç²—ä½“æ–‡æœ¬#!)")
    print("   â€¢ ä½¿ç”¨æœªçŸ¥çš„æ ¼å¼åŒ–å‘½ä»¤: #bold (åº”è¯¥æ˜¯ #b)")
    print("   â€¢ æ ‡ç­¾ä¸æˆå¯¹: #R çº¢è‰²æ–‡æœ¬ (ç¼ºå°‘ #!)")
    print("   â€¢ é¢œè‰²æ ‡ç­¾ä¸åŒ¹é…: Â§R çº¢è‰² Â§Y é»„è‰² (æ²¡æœ‰ Â§!)")
    print("   â†’ è¿™äº›å¯èƒ½å¯¼è‡´æ–‡æœ¬æ˜¾ç¤ºå¼‚å¸¸ï¼Œä½†ä¸ä¼šå´©æºƒ")
    
    print("\nğŸ”µ INFO (ä¿¡æ¯) - æœ€ä½çº§åˆ«ï¼Œå»ºè®®æ£€æŸ¥ï¼š")
    print("   â€¢ å¤æ‚çš„æç¤ºæ¡†ç»“æ„ä¸­çš„ä¸­æ–‡")
    print("   â€¢ ä½œç”¨åŸŸæ ¼å¼åŒ–ä¸­çš„ä¸­æ–‡")
    print("   â†’ è¿™äº›é€šå¸¸ä¸ä¼šå½±å“æ¸¸æˆè¿è¡Œï¼Œä½†å»ºè®®ä¿æŒä¸€è‡´æ€§")
    
    print("\nğŸ“Š CSVè¾“å‡ºè¯´æ˜ï¼š")
    print("   â€¢ æ ¡å¯¹è¿›åº¦åˆ—: æ˜¾ç¤ºç»Ÿè®¡æ‘˜è¦ (å¦‚: Errors: 3, Warnings: 2, Info: 1)")
    print("   â€¢ å¤‡æ³¨åˆ—: æ˜¾ç¤ºè¯¦ç»†é—®é¢˜åˆ—è¡¨ï¼Œæ¯è¡Œä¸€ä¸ªé—®é¢˜")
    print("   â€¢ æ ¼å¼: Lè¡Œå· | çº§åˆ« | æ¶ˆæ¯ | è¯¦æƒ…")

if __name__ == "__main__":
    print("=== åå¤„ç†éªŒè¯å™¨æµ‹è¯•æ–‡ä»¶ç”Ÿæˆå™¨ ===")
    
    # åˆ›å»ºæµ‹è¯•æ–‡ä»¶
    test_dir = create_test_files_with_issues()
    
    # è§£é‡ŠéªŒè¯çº§åˆ«
    explain_validation_levels()
    
    print(f"\nğŸ“ æµ‹è¯•æ–‡ä»¶ä½ç½®: {os.path.abspath(test_dir)}")
    print("ğŸ’¡ æç¤º: å°†è¿™äº›æ–‡ä»¶å¤åˆ¶åˆ°ä½ çš„modçš„localizationæ–‡ä»¶å¤¹ä¸­ï¼Œ")
    print("   ç„¶åè¿è¡Œç¿»è¯‘æµç¨‹ï¼Œå°±èƒ½çœ‹åˆ°åå¤„ç†éªŒè¯å™¨æ£€æµ‹åˆ°çš„é—®é¢˜äº†ï¼")
