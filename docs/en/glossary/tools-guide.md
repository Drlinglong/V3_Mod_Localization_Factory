# Game-Specific Glossary Module - Tool Usage Guide

## Overview

This module provides game-specific glossary functionality for the V3_Mod_Localization_Factory project, ensuring consistency and accuracy of terminology during the translation process.

## Glossary Parser Tools

### Overview
This module provides two Python scripts for converting terminology text files exported from Paratranz.cn's "Terminology" feature into structured JSON glossary files.

### Script File Description

#### 1. `parser.py` - Generic Glossary Parser
- **Function**: Intelligently parses Paratranz glossary text, automatically merges duplicate entries, and generates structured JSON files.
- **Applicable Games**: Victoria 3, Stellaris, EU4, HOI4, CK3, and all other supported games.
- **Input File**: `input.txt` (Terminology file exported from Paratranz).
- **Output File**: `glossary.json` (Structured glossary file).

#### 2. `validator.py` - Glossary Validator
- **Function**: Validates the quality of generated glossary files, checking data integrity and consistency.
- **Input File**: `glossary.json` (Glossary file generated by parser.py).
- **Output File**: `validation_report.txt` (Detailed validation report).
- **Validation Items**: ID conflict check, translation conflict check, synonym issue detection.

### Input File Format Description

The terminology file exported from Paratranz.cn has the following format:
```
English term name
Part of speech (Noun/Adjective/Verb)
Chinese translation
Remarks (optional)
Variant forms (optional, e.g., Term, Terms)
Modified on 2024/01/01
Comments 0
```

**Example**:
```
admiral
Noun
舰队司令
Original term
Admiral, Admirals, admirals
Modified on 2024/11/15
Comments 0
```

### Core Features

#### 1. Intelligent Deduplication
- Automatically identifies and merges duplicate term entries (case-insensitive).
- Intelligently merges remarks, avoiding information loss.
- Retains all variant forms, improving term matching accuracy.

#### 2. Structured Parsing
- Automatically identifies parts of speech (noun, adjective, verb).
- Extracts English terms and Chinese translations.
- Retains remarks and variant forms.
- Generates standardized JSON format.

#### 3. Metadata Management
- Automatically generates unique identifiers (IDs).
- Records last updated time.
- Annotates data source information.

### Usage

#### Step 1: Prepare Input File
1. Export the terminology file from Paratranz.cn project.
2. Rename the file to `input.txt`.
3. Ensure the file uses UTF-8 encoding.

#### Step 2: Configure Game Prefix
Modify the `CURRENT_GAME_PREFIX` variable in the script:
```python
# In parser.py
CURRENT_GAME_PREFIX = 'victoria3'  # or 'stellaris', 'eu4', 'hoi4', 'ck3'
```

#### Step 3: Run Parser
```bash
# Run in data/glossary directory
python parser.py
```

#### Step 4: Check Output
- The script will generate a `glossary.json` file.
- The console will display processing results and statistics.
- Check if the generated glossary file meets expectations.

#### Step 5: Validate Glossary Quality (Recommended)
Use `validator.py` to validate the generated glossary file:
```bash
python validator.py
```
The validator will check for:
- ID conflicts (multiple entries using the same ID).
- Translation conflicts (same English term with multiple Chinese translations).
- Synonym issues (same Chinese term translating to multiple English terms).
- Generates a detailed validation report `validation_report.txt`.

### Output File Example

Structure of the generated `glossary.json` file:
```json
{
  "metadata": {
    "description": "Victoria 3 Game and Mod Community Localization Glossary",
    "sources": ["Data from multiple community localization projects, such as Paratranz, etc."],
    "last_updated": "2025-01-27T10:30:00+11:00"
  },
  "entries": [
    {
      "id": "victoria3_admiral",
      "translations": {
        "en": "admiral",
        "zh-CN": "舰队司令"
      },
      "metadata": {
        "part_of_speech": "Noun",
        "remarks": "Original term"
      },
      "variants": {
        "en": ["Admiral", "Admirals", "admirals"]
      }
    }
  ]
}
```

### Advanced Configuration Options

#### 1. Custom Part-of-Speech Mapping
You can modify the `pos_map` variable to support more parts of speech:
```python
pos_map = {
    "名词": "Noun", 
    "形容词": "Adjective", 
    "动词": "Verb",
    "副词": "Adverb",
    "介词": "Preposition"
}
```

#### 2. Custom Output Filename
Modify the `output_filename` variable:
```python
output_filename = 'victoria3_glossary.json'  # Custom output filename
```

#### 3. Time Zone Settings
Modify time zone settings to match your local time:
```python
# Modify to your time zone
aest = pytz.timezone('Asia/Shanghai')  # China Standard Time
```

#### 4. Validator Configuration
You can modify the file paths in `validator.py`:
```python
def validate_glossary(input_path='glossary.json', output_path='validation_report.txt'):
    # Modify input and output file paths
    # input_path: Path to the glossary file to validate
    # output_path: Path to output the validation report
```

### Troubleshooting

#### Common Problems and Solutions

1. **Encoding Error**
   - Ensure the input file uses UTF-8 encoding.
   - Check if the file contains special characters.

2. **File Not Found**
   - Confirm `input.txt` exists in the same directory as the script.
   - Check file permissions.

3. **Parsing Failed**
   - Check if the input file format meets requirements.
   - Check console error messages.

4. **Output File Empty**
   - Check input file content.
   - Confirm game prefix is set correctly.

5. **Validator Error**
   - Ensure `parser.py` is run first to generate `glossary.json`.
   - Check if the JSON file format is correct.
   - Validate file encoding is UTF-8.

#### Debugging Suggestions

1. **Enable Detailed Logging**
   ```python
   import logging
   logging.basicConfig(level=logging.DEBUG)
   ```

2. **Test with Small Samples**
   - Test script functionality with a small amount of data first.
   - Confirm format is correct before processing the full file.

3. **Check Intermediate Results**
   - Add print statements at key steps.
   - Validate data parsing logic.

### Performance Optimization Suggestions

1. **Large File Handling**
   - For input files over 10MB, consider batch processing.
   - Monitor memory usage.

2. **Batch Processing**
   - Can modify the script to support batch processing of multiple input files.
   - Automatically merge multiple glossary files.

3. **Caching Mechanism**
   - For scenarios with repeated runs, a caching mechanism can be added.
   - Avoid re-parsing the same content.

## Supported Games

| Game | Glossary File Path | Status | Glossary Source |
|---|---|---|---|
| Victoria 3 | `data/glossary/victoria3/glossary.json` | ✅ Created | Victoria 3 Localization Update V1.2<br>Morgenröte \| Chinese<br>Better Politics Mod Simplified Chinese Localization<br>Milk Localization |
| Stellaris | `data/glossary/stellaris/glossary.json` | ✅ Created | Pigeon Group Localization Glossary<br>Shrouded Regions Localization Glossary<br>L-Network Stellaris Mod Localization Collection Glossary |
| EU4 | `data/glossary/eu4/glossary.json` | ✅ Created | Example Glossary (Basic Terms) |
| HOI4 | `data/glossary/hoi4/glossary.json` | ✅ Created | Example Glossary (Basic Terms) |
| CK3 | `data/glossary/ck3/glossary.json` | ✅ Created | Example Glossary (Basic Terms) |

## Glossary Source Description

### Victoria 3 Glossary Sources
- **Victoria 3 Localization Update V1.2**: Official localization update version, containing the latest game terminology.
- **Morgenröte \| Chinese**: Community localization project.
- **Better Politics Mod Simplified Chinese Localization**: Dedicated Chinese localization glossary for the political system Mod.
- **Milk Localization**: Community localization project, providing rich game terminology comparisons.

### Stellaris Glossary Sources
- **Pigeon Group Localization Glossary**: Famous Stellaris localization team, providing high-quality sci-fi terminology translations.
- **Shrouded Regions Localization Glossary**: Focuses on terminology translation for mysterious regions and special events.
- **L-Network Stellaris Mod Localization Collection Glossary**: Comprehensive Stellaris Mod localization glossary, covering multiple Mod contents.

### Other Game Glossary Sources
Currently, EU4, HOI4, and CK3 only have basic example glossaries, containing a small number of core terms. These glossaries are mainly used for:
- Validating the functionality of the glossary system.
- Demonstrating the standard format of glossary files.
- Providing a basic structure for future expansion.

**Note**: These example glossaries do not contain complete game terminology and are for system testing and demonstration purposes only.

## Update Log

- 2025-01-27: Initial version, supports 5 major games.
- Integrated into the main translation process.
- Supports dynamic prompt injection.
- Provides complete testing and documentation.
- 2025-01-27: Updated glossary source information.
  - Added detailed source description for Victoria 3 glossary.
  - Added detailed source description for Stellaris glossary.
  - Improved glossary source table and documentation.
- 2025-01-27: Added glossary parser tool description.
  - Added usage instructions for parser.py and validator.py.
  - Detailed description of Paratranz terminology file format.
  - Provided complete configuration and usage guide.
  - Added troubleshooting and performance optimization suggestions.
  - Integrated glossary quality validation function.