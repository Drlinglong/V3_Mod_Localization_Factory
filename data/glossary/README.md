# 游戏专用词典模块

## 概述

本模块为V3_Mod_Localization_Factory项目提供了游戏专用的词典功能，确保翻译过程中术语的一致性和准确性。

## 功能特性

### 1. 自动词典加载
- 在启动翻译脚本时自动加载对应游戏的词典文件
- 支持多种游戏：Victoria 3、Stellaris、EU4、HOI4、CK3
- 如果词典文件不存在，自动回退到无词典模式

### 2. 智能术语提取
- 在翻译前快速扫描待翻译文本
- 自动识别与词典中匹配的术语
- 支持术语变体和别名

### 3. 动态提示注入
- 将相关术语作为高优先级指令注入到AI翻译请求中
- 确保AI严格按照词典进行术语翻译
- 保持游戏术语的一致性和准确性

## 词典文件结构

每个游戏的词典文件位于 `data/glossary/{game_id}/glossary.json`，结构如下：

```json
{
  "metadata": {
    "description": "词典描述",
    "sources": ["来源1", "来源2"],
    "last_updated": "更新时间"
  },
  "entries": [
    {
      "translations": {
        "en": "英文术语",
        "zh-CN": "中文翻译"
      },
      "id": "唯一标识符",
      "metadata": {
        "part_of_speech": "词性",
        "remarks": "备注说明"
      },
      "variants": {
        "en": ["变体1", "变体2"]
      }
    }
  ]
}
```

## 支持的游戏

| 游戏 | 词典文件路径 | 状态 | 词典来源 |
|------|-------------|------|----------|
| Victoria 3 | `data/glossary/victoria3/glossary.json` | ✅ 已创建 | 维多利亚3 汉化 更新V1.2<br>Morgenröte \| 汉语<br>Better Politics Mod 简体中文汉化<br>牛奶汉化 |
| Stellaris | `data/glossary/stellaris/glossary.json` | ✅ 已创建 | 鸽组汉化词典<br>Shrouded Regions汉化词典<br>L网群星mod汉化集词典 |
| EU4 | `data/glossary/eu4/glossary.json` | ✅ 已创建 | 示例词典（基础术语） |
| HOI4 | `data/glossary/hoi4/glossary.json` | ✅ 已创建 | 示例词典（基础术语） |
| CK3 | `data/glossary/ck3/glossary.json` | ✅ 已创建 | 示例词典（基础术语） |

## 词典来源说明

### Victoria 3 词典来源
- **维多利亚3 汉化 更新V1.2**: 官方汉化更新版本，包含最新的游戏术语
- **Morgenröte \| 汉语**: 社区汉化项目，专注于德语背景的术语翻译
- **Better Politics Mod 简体中文汉化**: 政治系统Mod的专用汉化词典
- **牛奶汉化**: 社区汉化项目，提供丰富的游戏术语对照

### Stellaris 词典来源
- **鸽组汉化词典**: 著名的群星汉化组，提供高质量的科幻术语翻译
- **Shrouded Regions汉化词典**: 专注于神秘区域和特殊事件的术语翻译
- **L网群星mod汉化集词典**: 综合性的群星Mod汉化词典，涵盖多个Mod内容

### 其他游戏词典来源
目前EU4、HOI4和CK3只有基础的示例词典，包含少量核心术语。这些词典主要用于：
- 验证词典系统的功能
- 展示词典文件的标准格式
- 为后续扩展提供基础结构

**注意**: 这些示例词典不包含完整的游戏术语，仅用于系统测试和演示目的。

## 使用方法

### 1. 自动使用
词典功能已集成到主翻译流程中，无需手动配置。当您运行翻译脚本时：

1. 选择游戏后，系统自动加载对应词典
2. 翻译过程中自动提取相关术语
3. 将术语作为高优先级指令注入AI请求

### 2. 手动测试
可以使用测试脚本验证词典功能：

```bash
python test_glossary.py
```

### 3. 添加新游戏词典
1. 在 `data/glossary/` 下创建新的游戏文件夹
2. 创建 `glossary.json` 文件
3. 按照标准格式添加术语条目
4. 确保游戏配置中的 `id` 字段与文件夹名称一致

## 词典条目格式说明

### 必需字段
- `translations`: 包含源语言和目标语言的翻译对照
- `id`: 唯一标识符，建议使用 `{game_id}_{term}` 格式

### 可选字段
- `metadata.part_of_speech`: 词性（如 Noun、Verb、Adjective）
- `metadata.remarks`: 翻译注意事项或说明
- `variants`: 术语的变体形式，用于提高匹配准确性

## 技术实现

### 核心组件
- `GlossaryManager`: 词典管理器类
- `load_game_glossary()`: 加载游戏词典
- `extract_relevant_terms()`: 提取相关术语
- `create_dynamic_glossary_prompt()`: 生成动态提示

### 集成点
- `initial_translate.py`: 启动时自动加载词典
- `openai_handler.py`: 翻译过程中注入词典提示
- 支持所有API供应商（OpenAI、Gemini、Qwen）

## 注意事项

1. **词典文件编码**: 请使用UTF-8编码保存词典文件
2. **术语更新**: 定期更新词典以保持术语的准确性和时效性
3. **性能影响**: 词典功能对翻译性能影响很小，主要是在启动时加载和翻译前扫描
4. **回退机制**: 如果词典加载失败，系统会自动使用无词典模式，确保翻译功能正常运行

## 故障排除

### 常见问题
1. **词典未加载**: 检查词典文件路径和格式是否正确
2. **术语未匹配**: 确认术语拼写和大小写是否一致
3. **性能问题**: 检查词典文件大小，过大的文件可能影响加载速度

### 日志信息
词典相关的操作会在日志中记录，包括：
- 词典加载状态
- 术语提取数量
- 提示注入情况

## 更新日志

- 2025-01-27: 初始版本，支持5个主要游戏
- 集成到主翻译流程
- 支持动态提示注入
- 提供完整的测试和文档
- 2025-01-27: 更新词典来源信息
  - 添加Victoria 3词典详细来源说明
  - 添加Stellaris词典详细来源说明
  - 完善词典来源表格和说明文档